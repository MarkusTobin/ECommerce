@page "/cart"
@using ECommerce.Frontend.Services
@inject CartService CartService
@inject NavigationManager NavigationManager

<PageTitle>Shopping Cart</PageTitle>

<h3>Your Cart</h3>

@if (cartItems.Count == 0)
{
    <p>Your cart is empty.</p>
}
else
{
    <MudTable Items="cartItems" Hover="true">
        <HeaderContent>
            <MudTh>Product</MudTh>
            <MudTh>Price</MudTh>
            <MudTh>Quantity</MudTh>
            <MudTh>Total</MudTh>
            <MudTh>Actions</MudTh>
        </HeaderContent>
        <RowTemplate>
            <MudTd DataLabel="Product">@context.Product.Name</MudTd>
            <MudTd DataLabel="Price">@context.Product.Price.ToString("C")</MudTd>
            <MudTd DataLabel="Quantity">
                <MudNumericField T="int" @bind-Value="context.Quantity" Min="1" Max="100"
                                 OnBlur="() => UpdateQuantity(context)">
                </MudNumericField>
            </MudTd>
            <MudTd DataLabel="Total">@context.Product.Price * context.Quantity</MudTd>
            <MudTd DataLabel="Actions">
                <MudButton Variant="Variant.Filled" Color="Color.Secondary" OnClick="() => RemoveFromCart(context.Product.Id)">
                    Remove
                </MudButton>
            </MudTd>
        </RowTemplate>
    </MudTable>

    <MudText Typo="Typo.h6">Total Price: @CartService.GetTotalPrice().ToString("C")</MudText>

    <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="ProceedToCheckout">
        Proceed to Checkout
    </MudButton>
}

@code {
    private List<CartItem> cartItems;

    protected override void OnInitialized()
    {
        cartItems = CartService.GetCart();
    }

    private void RemoveFromCart(string productId)
    {
        cartItems = CartService.GetCart();
    }

    private void UpdateQuantity(CartItem item)
    {
    }

    private void ProceedToCheckout()
    {
        NavigationManager.NavigateTo("/checkout-form");
    }
}